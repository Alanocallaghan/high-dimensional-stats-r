---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 02-high-dimensional-regression_b.md in _episodes_rmd/
title: "Stepwise feature selection for regression"
teaching: 0
exercises: 0
questions:
- "Why would we want to find a subset of features
  that are associated with an outcome?"
- "How can we iteratively find a good subset of our features
  variables to use for regression?"
- "What are some risks and downsides of iterative feature
  selection?"
objectives:
- "Understand multiple regression in a biomedical context."
- "Understand how to fit a stepwise regression model."
keypoints:
- "Sets of features can be more predictive and provide
  a better explanation than a single feature alone."
- "Stepwise regression allows us to find a set of features that
  are associated with an outcome (eg, age)."
- "Stepwise regression will tend to retain only one
  feature out of many that are correlated."
- "Stepwise regression is not very efficient."
math: yes
---





In the previous 

Another way of modelling these data is to model age as 

$$
    y_j = \beta_0 + \beta_1 X_1 + \dots \beta_p X_p + \epsilon_j
$$



~~~
suppressPackageStartupMessages({
    library("glmnet")
    library("limma")
    library("minfi")
    library("here")
    library("broom")
})

if (!file.exists(here("data/methylation.rds"))) {
    source(here("data/methylation.R"))
}
norm <- readRDS(here("data/methylation.rds"))

lim <- norm
y <- lim$Age
X <- getM(lim)
~~~
{: .language-r}

However when the number of predictors is greater than the number of samples
(basically always true in genetics) it isn't possible to include everything!

There are some techniques that you can use to find a set of predictors!

- screening (correlation etc): bad, don't do
- screening (variance): not necessarily bad if the screening variable is sensible
- forward/reverse/best subset selection


~~~
if (!file.exists(here("data/synthetic.rds"))) {
    source(here("data/synthetic.R"))
}
synthetic <- readRDS(here("data/synthetic.rds"))
~~~
{: .language-r}





~~~
X <- assay(synthetic)
y <- synthetic$age
beta <- rowData(synthetic)$true_beta
names(beta) <- rownames(synthetic)
## challenge 3: fit y on x univariate
## compare with true betas
cc <- sapply(seq_len(nrow(X)), function(i) {
    coef(lm(y ~ X[i, ]))[[2]]
})
plot(cc, beta, pch = 19, cex = 0.5)
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-4-1.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" width="612" style="display: block; margin: auto;" />




> ## Exercise
> Perform forward subset selection on the methylation data.
> 
> 
> > ## Solution
> > 
> > 
> {: .solution}
{: .challenge}




~~~
## challenge 4: forward selection
## compare with true betas
xy <- as.data.frame(cbind(t(X), y = y))
int <- lm(y ~ 1, data = xy)
all <- lm(y ~ . + 0, data = xy)
forward <- step(
    int,
    scope = list(upper = formula(all), lower = formula(int)),
    direction = "forward",
    trace = 0
)
forward$anova
~~~
{: .language-r}



~~~
           Step Df   Deviance Resid. Df Resid. Dev         AIC
1               NA         NA        99 1552.99000 276.2767198
2  + feature_44 -1 764.664537        98  788.32546 210.4740842
3  + feature_50 -1 333.908028        97  454.41743 157.3846049
4  + feature_35 -1 149.961561        96  304.45587 119.3355977
5  + feature_25 -1  57.988793        95  246.46708 100.2058253
6  + feature_89 -1  48.496366        94  197.97071  80.2948929
7  + feature_75 -1  39.402007        93  158.56871  60.1017798
8  + feature_77 -1  27.474566        92  131.09414  43.0745512
9  + feature_17 -1  13.291172        91  117.80297  34.3843291
10 + feature_71 -1  15.842617        90  101.96035  21.9413849
11 + feature_30 -1   5.875036        89   96.08532  18.0066324
12  + feature_7 -1   5.886396        88   90.19892  13.6847278
13 + feature_11 -1   4.926577        87   85.27234  10.0679994
14 + feature_13 -1   3.905422        86   81.36692   7.3798634
15 + feature_22 -1   3.525300        85   77.84162   4.9506085
16 + feature_61 -1   3.499954        84   74.34167   2.3501412
17 + feature_47 -1   3.082259        83   71.25941   0.1156674
18 + feature_87 -1   2.605650        82   68.65376  -1.6094305
19 + feature_57 -1   2.826964        81   65.82679  -3.8143215
20 + feature_24 -1   3.722994        80   62.10380  -7.6362994
21 + feature_85 -1   2.870175        79   59.23363 -10.3680802
22 + feature_90 -1   2.719236        78   56.51439 -13.0674895
23 + feature_53 -1   2.000447        77   54.51394 -14.6713690
24 + feature_91 -1   2.048430        76   52.46551 -16.5014135
25 + feature_76 -1   1.907970        75   50.55754 -18.2058040
26 + feature_79 -1   2.238515        74   48.31903 -20.7344750
27 + feature_65 -1   1.555325        73   46.76370 -22.0062866
28 + feature_23 -1   1.471730        72   45.29197 -23.2040371
29  + feature_2 -1   1.786132        71   43.50584 -25.2274978
30 + feature_18 -1   1.571847        70   41.93399 -26.9073369
31 + feature_69 -1   1.186814        69   40.74718 -27.7783542
32 + feature_64 -1   1.281114        68   39.46607 -28.9728953
33 + feature_20 -1   1.379509        67   38.08656 -30.5308778
34 + feature_14 -1   1.254961        66   36.83160 -31.8814085
35 + feature_92 -1   1.292671        65   35.53893 -33.4541580
~~~
{: .output}



~~~
plot(coef(forward), beta[names(coef(forward))])
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-5-1.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" width="612" style="display: block; margin: auto;" />


~~~
## note about backward/both, not a challenge
all <- lm(y ~ . + 0, data = xy)
backward <- step(
    all,
    scope = formula(all),
    direction = "backward",
    trace = 0
)
backward$anova
~~~
{: .language-r}



~~~
           Step Df     Deviance Resid. Df Resid. Dev        AIC
1               NA           NA         1   5.735054  -87.85731
2  - feature_28  1 1.482269e-05         2   5.735069  -89.85705
3  - feature_80  1 7.798126e-05         3   5.735147  -91.85569
4  - feature_54  1 2.414418e-04         4   5.735388  -93.85148
5  - feature_13  1 1.293527e-03         5   5.736681  -95.82893
6  - feature_67  1 2.034319e-03         6   5.738716  -97.79347
7  - feature_77  1 2.033182e-03         7   5.740749  -99.75805
8  - feature_36  1 2.482247e-03         8   5.743231 -101.71482
9  - feature_12  1 3.988904e-03         9   5.747220 -103.64539
10 - feature_34  1 7.021614e-03        10   5.754242 -105.52329
11  - feature_6  1 4.614754e-03        11   5.758857 -107.44313
12 - feature_96  1 1.132727e-02        12   5.770184 -109.24663
13 - feature_94  1 1.905257e-02        13   5.789236 -110.91698
14 - feature_18  1 1.583302e-02        14   5.805069 -112.64386
15 - feature_48  1 3.475072e-02        15   5.839820 -114.04702
16 - feature_86  1 5.640204e-02        16   5.896222 -115.08584
17 - feature_68  1 3.004603e-02        17   5.926268 -116.57755
18 - feature_37  1 4.824235e-02        18   5.974511 -117.76680
19 - feature_70  1 2.446649e-02        19   5.998977 -119.35812
20 - feature_84  1 3.612105e-02        20   6.035098 -120.75781
21 - feature_17  1 6.064252e-02        21   6.095741 -121.75799
22 - feature_76  1 5.270397e-02        22   6.148445 -122.89711
23 - feature_95  1 6.248579e-02        23   6.210930 -123.88595
~~~
{: .output}



~~~
plot(coef(backward), beta[names(coef(backward))])
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-6-1.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" width="612" style="display: block; margin: auto;" />


{% include links.md %}
