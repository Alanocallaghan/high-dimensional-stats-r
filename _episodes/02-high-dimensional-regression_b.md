---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 02-high-dimensional-regression_b.md in _episodes_rmd/
title: "Stepwise feature selection for regression"
teaching: 0
exercises: 0
questions:
- "Why would we want to find a subset of features
  that are associated with an outcome?"
- "How can we iteratively find a good subset of our features
  variables to use for regression?"
- "What are some risks and downsides of iterative feature
  selection?"
objectives:
- "Understand multiple regression in a biomedical context."
- "Understand how to fit a stepwise regression model."
keypoints:
- "Sets of features can be more predictive and provide
  a better explanation than a single feature alone."
- "Stepwise regression allows us to find a set of features that
  are associated with an outcome (eg, age)."
- "Stepwise regression will tend to retain only one
  feature out of many that are correlated."
- "Stepwise regression is not very efficient."
math: yes
---





In the previous 

Another way of modelling these data is to model age as 

$$
    y_j = \beta_0 + \beta_1 X_1 + \dots \beta_p X_p + \epsilon_j
$$



~~~
suppressPackageStartupMessages({
    library("glmnet")
    library("limma")
    library("minfi")
    library("here")
    library("broom")
})

if (!file.exists(here("data/methylation.rds"))) {
    source(here("data/methylation.R"))
}
norm <- readRDS(here("data/methylation.rds"))

lim <- norm
y <- lim$Age
X <- getM(lim)
~~~
{: .language-r}

However when the number of predictors is greater than the number of samples
(basically always true in genetics) it isn't possible to include everything!

There are some techniques that you can use to find a set of predictors!

- screening (correlation etc): bad, don't do
- screening (variance): not necessarily bad if the screening variable is sensible
- forward/reverse/best subset selection


~~~
if (!file.exists(here("data/synthetic.rds"))) {
    source(here("data/synthetic.R"))
}
synthetic <- readRDS(here("data/synthetic.rds"))
~~~
{: .language-r}





~~~
X <- assay(synthetic)
y <- synthetic$age
beta <- rowData(synthetic)$true_beta
names(beta) <- rownames(synthetic)
## challenge 3: fit y on x univariate
## compare with true betas
cc <- sapply(seq_len(nrow(X)), function(i) {
    coef(lm(y ~ X[i, ]))[[2]]
})
plot(cc, beta, pch = 19, cex = 0.5)
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-4-1.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" width="612" style="display: block; margin: auto;" />




> ## Exercise
> Perform forward subset selection on the methylation data.
> 
> 
> > ## Solution
> > 
> > 
> {: .solution}
{: .challenge}




~~~
## challenge 4: forward selection
## compare with true betas
xy <- as.data.frame(cbind(t(X), y = y))
int <- lm(y ~ 1, data = xy)
all <- lm(y ~ . + 0, data = xy)
forward <- step(
    int,
    scope = list(upper = formula(all), lower = formula(int)),
    direction = "forward",
    trace = 0
)
forward$anova
~~~
{: .language-r}



~~~
           Step Df     Deviance Resid. Df   Resid. Dev         AIC
1               NA           NA        99 6242.9600000  415.403952
2  + feature_91 -1 1.060413e+03        98 5182.5465948  398.788165
3   + feature_4 -1 9.177368e+02        97 4264.8097765  381.298267
4  + feature_76 -1 7.277887e+02        96 3537.0210408  364.586995
5  + feature_48 -1 4.929487e+02        95 3044.0723623  351.578130
6  + feature_52 -1 4.224279e+02        94 2621.6444636  338.638687
7  + feature_43 -1 4.932382e+02        93 2128.4062200  319.795854
8  + feature_40 -1 5.031011e+02        92 1625.3051203  294.828066
9  + feature_87 -1 3.827618e+02        91 1242.5432743  269.974540
10 + feature_79 -1 1.695510e+02        90 1072.9923075  257.303639
11 + feature_65 -1 1.983547e+02        89  874.6375946  238.863944
12 + feature_10 -1 2.347286e+02        88  639.9090014  209.615580
13 + feature_64 -1 1.282220e+02        87  511.6870479  189.254302
14  + feature_9 -1 1.601411e+02        86  351.5459949  153.717037
15 + feature_32 -1 4.886376e+01        85  302.6822341  140.751334
16 + feature_25 -1 4.542075e+01        84  257.2614867  126.492284
17  + feature_3 -1 6.773244e+01        83  189.5290516   97.937213
18 + feature_54 -1 4.697410e+01        82  142.5549534   71.455738
19 + feature_90 -1 4.593564e+01        81   96.6193141   34.560847
20 + feature_86 -1 1.141253e+01        80   85.2067870   23.991090
21 + feature_95 -1 6.255496e+00        79   78.9512909   18.366090
22 + feature_20 -1 5.252486e+00        78   73.6988046   13.481639
23 + feature_93 -1 6.319146e+00        77   67.3796586    6.517299
24 + feature_47 -1 7.447107e+00        76   59.9325519   -3.195039
25 + feature_21 -1 6.019032e+00        75   53.9135202  -11.778890
26 + feature_72 -1 5.835166e+00        74   48.0783544  -21.233812
27 + feature_58 -1 2.299486e+00        73   45.7788681  -24.134760
28 + feature_66 -1 2.046597e+00        72   43.7322707  -26.708390
29 + feature_19 -1 1.977100e+00        71   41.7551709  -29.334689
30 + feature_26 -1 2.032399e+00        70   39.7227723  -32.324555
31 + feature_29 -1 2.014253e+00        69   37.7085196  -35.528413
32 + feature_56 -1 1.845633e+00        68   35.8628870  -38.546721
33 + feature_71 -1 1.677445e+00        67   34.1854423  -41.337030
34 + feature_57 -1 1.685625e+00        66   32.4998175  -44.393571
35 + feature_45 -1 1.969524e+00        65   30.5302934  -48.645077
36 + feature_81 -1 2.234624e+00        64   28.2956695  -54.246142
37 + feature_30 -1 1.222853e+00        63   27.0728161  -56.664006
38  + feature_6 -1 1.335149e+00        62   25.7376668  -59.721463
39 + feature_38 -1 1.041674e+00        61   24.6959925  -61.852920
40 + feature_22 -1 1.328512e+00        60   23.3674805  -65.382485
41 + feature_63 -1 9.299263e-01        59   22.4375542  -67.443411
42 + feature_18 -1 1.077105e+00        58   21.3604495  -70.362913
43 + feature_46 -1 8.769934e-01        57   20.4834561  -72.555264
44 + feature_34 -1 1.068088e+00        56   19.4153683  -75.910525
45 + feature_80 -1 1.013071e+00        55   18.4022970  -79.269469
46 + feature_16 -1 1.047125e+00        54   17.3551717  -83.127964
47 + feature_33 -1 9.194530e-01        53   16.4357187  -86.571325
48 + feature_85 -1 9.147941e-01        52   15.5209246  -90.298110
49 + feature_92 -1 7.978637e-01        51   14.7230609  -93.575516
50 + feature_51 -1 8.093472e-01        50   13.9137136  -97.229524
51  + feature_2 -1 6.940616e-01        49   13.2196521 -100.346567
52 + feature_88 -1 6.114219e-01        48   12.6082302 -103.082040
53 + feature_84 -1 6.425432e-01        47   11.9656870 -106.312705
54 + feature_83 -1 6.951200e-01        46   11.2705670 -110.297555
55 + feature_13 -1 6.155039e-01        45   10.6550631 -113.913500
56 + feature_77 -1 5.169250e-01        44   10.1381381 -116.886582
57  + feature_5 -1 7.248856e-01        43    9.4132526 -122.305164
58 + feature_15 -1 6.504131e-01        42    8.7628394 -127.465020
59 + feature_75 -1 2.647017e-01        41    8.4981378 -128.532313
60 + feature_89 -1 3.566983e-01        40    8.1414395 -130.820318
61 + feature_11 -1 2.780234e-01        39    7.8634161 -132.294906
62 + feature_55 -1 2.474519e-01        38    7.6159642 -133.492358
63 + feature_17 -1 3.024958e-01        37    7.3134684 -135.545255
64 + feature_28 -1 3.120292e-01        36    7.0014392 -137.905446
65 + feature_23 -1 3.315141e-01        35    6.6699250 -140.756156
66 + feature_61 -1 2.989676e-01        34    6.3709574 -143.342043
67 + feature_73 -1 4.398555e-01        33    5.9311019 -148.496017
68  + feature_8 -1 4.898288e-01        32    5.4412731 -155.115713
69 + feature_24 -1 5.726208e-01        31    4.8686524 -164.235301
70 + feature_44 -1 4.471915e-01        30    4.4214609 -171.870003
71 + feature_67 -1 3.941369e-01        29    4.0273239 -179.206806
72 + feature_53 -1 4.316081e-01        28    3.5957158 -188.542710
73 + feature_12 -1 1.824390e-01        27    3.4132769 -191.749740
74 + feature_69 -1 2.146902e-01        26    3.1985866 -196.246115
75 + feature_39 -1 1.427225e-01        25    3.0558642 -198.810777
76  + feature_1 -1 2.747771e-01        24    2.7810870 -206.232832
77 + feature_31 -1 3.728517e-01        23    2.4082353 -218.627593
78 + feature_49 -1 1.690781e-01        22    2.2391573 -223.907061
79 + feature_94 -1 1.598099e-01        21    2.0793474 -229.311612
80 + feature_41 -1 2.094966e-01        20    1.8698507 -237.931160
81 + feature_70 -1 1.533688e-01        19    1.7164819 -244.489342
82 + feature_74 -1 3.366176e-01        18    1.3798643 -264.318505
83 + feature_82 -1 1.252471e-01        17    1.2546172 -271.833968
84  + feature_7 -1 1.086077e-01        16    1.1460095 -278.888426
85 + feature_37 -1 1.143565e-01        15    1.0316530 -287.400782
86 + feature_42 -1 8.395362e-02        14    0.9476994 -293.888813
87 + feature_78 -1 5.635894e-02        13    0.8913404 -298.019903
88 + feature_60 -1 4.778705e-02        12    0.8435534 -301.530227
89 + feature_14 -1 5.688079e-02        11    0.7866726 -306.511331
90 + feature_96 -1 1.061998e-01        10    0.6804728 -319.013764
91 + feature_50 -1 4.630775e-02         9    0.6341650 -324.061624
92 + feature_36 -1 9.348083e-02         8    0.5406842 -338.009008
93 + feature_27 -1 4.958967e-02         7    0.4910945 -345.628881
94 + feature_98 -1 5.018844e-02         6    0.4409061 -354.409353
95 + feature_68 -1 1.386859e-01         5    0.3022202 -390.176943
96 + feature_62 -1 1.387089e-02         4    0.2883494 -392.875269
97 + feature_97 -1 1.501309e-02         3    0.2733363 -396.222269
98 + feature_35 -1 7.241607e-03         2    0.2660947 -396.907337
~~~
{: .output}



~~~
plot(coef(forward), beta[names(coef(forward))])
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-5-1.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" width="612" style="display: block; margin: auto;" />


~~~
## note about backward/both, not a challenge
all <- lm(y ~ . + 0, data = xy)
backward <- step(
    all,
    scope = formula(all),
    direction = "backward",
    trace = 0
)
backward$anova
~~~
{: .language-r}



~~~
          Step Df     Deviance Resid. Df Resid. Dev       AIC
1              NA           NA         1  0.2658481 -395.0000
2 - feature_59  1 0.0002465639         2  0.2660947 -396.9073
3 - feature_55  1 0.0026231833         3  0.2687178 -397.9264
4 - feature_35  1 0.0047515052         4  0.2734693 -398.1736
5 - feature_71  1 0.0034427543         5  0.2769121 -398.9225
6 - feature_92  1 0.0040266585         6  0.2809388 -399.4789
~~~
{: .output}



~~~
plot(coef(backward), beta[names(coef(backward))])
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-6-1.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" width="612" style="display: block; margin: auto;" />


{% include links.md %}
