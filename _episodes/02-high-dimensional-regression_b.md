---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 02-high-dimensional-regression_b.md in _episodes_rmd/
title: "Stepwise feature selection for regression"
teaching: 0
exercises: 0
questions:
- "Why would we want to find a subset of features
  that are associated with an outcome?"
- "How can we iteratively find a good subset of our features
  variables to use for regression?"
- "What are some risks and downsides of iterative feature
  selection?"
objectives:
- "Understand multiple regression in a biomedical context."
- "Understand how to fit a stepwise regression model."
keypoints:
- "Sets of features can be more predictive and provide
  a better explanation than a single feature alone."
- "Stepwise regression allows us to find a set of features that
  are associated with an outcome (eg, age)."
- "Stepwise regression will tend to retain only one
  feature out of many that are correlated."
- "Stepwise regression is not very efficient."
math: yes
---





In the previous 

Another way of modelling these data is to model age as 

$$
    y_j = \beta_0 + \beta_1 X_1 + \dots \beta_p X_p + \epsilon_j
$$



~~~
suppressPackageStartupMessages({
    library("glmnet")
    library("limma")
    library("minfi")
    library("here")
    library("broom")
})

if (!file.exists(here("data/methylation.rds"))) {
    source(here("data/methylation.R"))
}
norm <- readRDS(here("data/methylation.rds"))

lim <- norm
y <- lim$Age
X <- getM(lim)
~~~
{: .language-r}

However when the number of predictors is greater than the number of samples
(basically always true in genetics) it isn't possible to include everything!

There are some techniques that you can use to find a set of predictors!

- screening (correlation etc): bad, don't do
- screening (variance): not necessarily bad if the screening variable is sensible
- forward/reverse/best subset selection


~~~
if (!file.exists(here("data/synthetic.rds"))) {
    source(here("data/synthetic.R"))
}
synthetic <- readRDS(here("data/synthetic.rds"))
~~~
{: .language-r}





~~~
X <- assay(synthetic)
y <- synthetic$age
beta <- rowData(synthetic)$true_beta
names(beta) <- rownames(synthetic)
## challenge 3: fit y on x univariate
## compare with true betas
cc <- sapply(seq_len(nrow(X)), function(i) {
    coef(lm(y ~ X[i, ]))[[2]]
})
plot(cc, beta, pch = 19, cex = 0.5)
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-4-1.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" width="612" style="display: block; margin: auto;" />




> ## Exercise
> Perform forward subset selection on the methylation data.
> 
> 
> > ## Solution
> > 
> > 
> {: .solution}
{: .challenge}




~~~
## challenge 4: forward selection
## compare with true betas
xy <- as.data.frame(cbind(t(X), y = y))
int <- lm(y ~ 1, data = xy)
all <- lm(y ~ . + 0, data = xy)
forward <- step(
    int,
    scope = list(upper = formula(all), lower = formula(int)),
    direction = "forward",
    trace = 0
)
forward$anova
~~~
{: .language-r}



~~~
           Step Df    Deviance Resid. Df Resid. Dev         AIC
1               NA          NA        99 2936.75000 339.9888621
2  + feature_60 -1 433.6625996        98 2503.08740 326.0110023
3  + feature_89 -1 526.5398615        97 1976.54754 304.3936749
4  + feature_33 -1 449.5320580        96 1527.01548 280.5900257
5  + feature_93 -1 315.4178761        95 1211.59760 259.4524916
6  + feature_17 -1 271.8092435        94  939.78836 236.0484516
7  + feature_39 -1 217.5701853        93  722.21818 211.7157090
8  + feature_64 -1 140.5251475        92  581.69303 192.0772680
9  + feature_90 -1 110.0598857        91  471.63314 173.1031257
10 + feature_32 -1 144.2278094        90  327.40533 138.6028769
11 + feature_13 -1  59.7912561        89  267.61408 120.4375746
12 + feature_85 -1  65.8274438        88  201.78663  94.2040683
13 + feature_38 -1  52.3925213        87  149.39411  66.1417676
14 + feature_43 -1  37.9380571        86  111.45606  38.8460202
15 + feature_18 -1  22.5808472        85   88.87521  18.2063040
16 + feature_50 -1  13.6176265        84   75.25758   3.5746461
17  + feature_3 -1   4.7735927        83   70.48399  -0.9784614
18 + feature_78 -1   5.0284993        82   65.45549  -6.3799827
19 + feature_30 -1   4.5126245        81   60.94286 -11.5233403
20 + feature_31 -1   3.1481722        80   57.79469 -14.8273237
21 + feature_74 -1   2.6798285        79   55.11486 -17.5750739
22 + feature_21 -1   2.8794369        78   52.23543 -20.9409238
23 + feature_14 -1   1.9449305        77   50.29050 -22.7354059
24 + feature_76 -1   2.7542704        76   47.53623 -26.3678106
25 + feature_67 -1   1.8806418        75   45.65558 -28.4044254
26 + feature_94 -1   2.0696715        74   43.58591 -31.0436184
27 + feature_88 -1   1.1261924        73   42.45972 -31.6614310
28 + feature_51 -1   1.2431981        72   41.21652 -32.6330978
29 + feature_80 -1   1.9271948        71   39.28933 -35.4217264
30  + feature_4 -1   1.4646088        70   37.82472 -37.2207358
31 + feature_46 -1   1.5886614        69   36.23606 -39.5115501
32  + feature_6 -1   0.9994503        68   35.23661 -40.3084668
33 + feature_66 -1   0.8557680        67   34.38084 -40.7670777
34 + feature_49 -1   1.0436558        66   33.33718 -41.8496794
35 + feature_23 -1   1.2088533        65   32.12833 -43.5431987
36 + feature_58 -1   0.9523618        64   31.17597 -44.5522634
37 + feature_59 -1   0.8389514        63   30.33702 -45.2801536
38 + feature_29 -1   0.8800444        62   29.45697 -46.2239543
39 + feature_68 -1   1.4066442        61   28.05033 -49.1169847
40 + feature_83 -1   0.7723760        60   27.27795 -49.9091416
41 + feature_98 -1   0.9087383        59   26.36921 -51.2972991
42 + feature_54 -1   0.7344049        58   25.63481 -52.1219027
43 + feature_36 -1   0.6210230        57   25.01379 -52.5743069
44 + feature_53 -1   0.5907947        56   24.42299 -52.9645225
45 + feature_10 -1   0.5633303        55   23.85966 -53.2980970
~~~
{: .output}



~~~
plot(coef(forward), beta[names(coef(forward))])
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-5-1.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" width="612" style="display: block; margin: auto;" />


~~~
## note about backward/both, not a challenge
all <- lm(y ~ . + 0, data = xy)
backward <- step(
    all,
    scope = formula(all),
    direction = "backward",
    trace = 0
)
backward$anova
~~~
{: .language-r}



~~~
  Step Df Deviance Resid. Df Resid. Dev       AIC
1      NA       NA         1  0.0552284 -552.1448
~~~
{: .output}



~~~
plot(coef(backward), beta[names(coef(backward))])
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-6-1.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" width="612" style="display: block; margin: auto;" />


{% include links.md %}
