---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 02-high-dimensional-regression_b.md in _episodes_rmd/
title: "Stepwise feature selection for regression"
teaching: 0
exercises: 0
questions:
- "Why would we want to find a subset of features
  that are associated with an outcome?"
- "How can we iteratively find a good subset of our features
  variables to use for regression?"
- "What are some risks and downsides of iterative feature
  selection?"
objectives:
- "Understand multiple regression in a biomedical context."
- "Understand how to fit a stepwise regression model."
keypoints:
- "Sets of features can be more predictive and provide
  a better explanation than a single feature alone."
- "Stepwise regression allows us to find a set of features that
  are associated with an outcome (eg, age)."
- "Stepwise regression will tend to retain only one
  feature out of many that are correlated."
- "Stepwise regression is not very efficient."
math: yes
---





In the previous 

Another way of modelling these data is to model age as 

$$
    y_j = \beta_0 + \beta_1 X_1 + \dots \beta_p X_p + \epsilon_j
$$



~~~
suppressPackageStartupMessages({
    library("glmnet")
    library("limma")
    library("minfi")
    library("here")
    library("broom")
})

if (!file.exists(here("data/methylation.rds"))) {
    source(here("data/methylation.R"))
}
norm <- readRDS(here("data/methylation.rds"))

lim <- norm
y <- lim$Age
X <- getM(lim)
~~~
{: .language-r}

However when the number of predictors is greater than the number of samples
(basically always true in genetics) it isn't possible to include everything!

There are some techniques that you can use to find a set of predictors!

- screening (correlation etc): bad, don't do
- screening (variance): not necessarily bad if the screening variable is sensible
- forward/reverse/best subset selection


~~~
if (!file.exists(here("data/synthetic.rds"))) {
    source(here("data/synthetic.R"))
}
synthetic <- readRDS(here("data/synthetic.rds"))
~~~
{: .language-r}





~~~
X <- assay(synthetic)
y <- synthetic$age
beta <- rowData(synthetic)$true_beta
names(beta) <- rownames(synthetic)
## challenge 3: fit y on x univariate
## compare with true betas
cc <- sapply(seq_len(nrow(X)), function(i) {
    coef(lm(y ~ X[i, ]))[[2]]
})
plot(cc, beta, pch = 19, cex = 0.5)
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-4-1.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" width="612" style="display: block; margin: auto;" />




> ## Exercise
> Perform forward subset selection on the methylation data.
> 
> 
> > ## Solution
> > 
> > 
> {: .solution}
{: .challenge}




~~~
## challenge 4: forward selection
## compare with true betas
xy <- as.data.frame(cbind(t(X), y = y))
int <- lm(y ~ 1, data = xy)
all <- lm(y ~ . + 0, data = xy)
forward <- step(
    int,
    scope = list(upper = formula(all), lower = formula(int)),
    direction = "forward",
    trace = 0
)
forward$anova
~~~
{: .language-r}



~~~
           Step Df     Deviance Resid. Df Resid. Dev        AIC
1               NA           NA        99 4725.36000 387.552884
2  + feature_28 -1 1189.1637660        98 3536.19623 360.563673
3  + feature_30 -1 1056.4926294        97 2479.70360 327.072413
4  + feature_34 -1  502.5557489        96 1977.14786 306.424042
5  + feature_23 -1  299.9323520        95 1677.21550 291.972007
6   + feature_3 -1  297.3176211        94 1379.89788 274.459459
7  + feature_32 -1  223.5977792        93 1156.30010 258.781043
8  + feature_44 -1  177.6237903        92  978.67631 244.103077
9  + feature_86 -1  127.8557198        91  850.82059 232.103110
10 + feature_87 -1  186.1569867        90  664.66361 209.411087
11 + feature_75 -1  187.1308171        89  477.53279 178.346264
12  + feature_6 -1  131.4076023        88  346.12519 148.163034
13 + feature_58 -1  131.3725184        87  214.75267 102.431680
14 + feature_20 -1   50.8134539        86  163.93921  77.432553
15 + feature_62 -1   24.4003743        85  139.53884  63.317280
16 + feature_35 -1   29.2177041        84  110.32114  41.822535
17 + feature_55 -1   13.2296725        83   97.09146  31.048327
18 + feature_83 -1    8.9138627        82   88.17760  23.418279
19 + feature_21 -1   12.9851095        81   75.19249   9.488120
20 + feature_13 -1   11.6526700        80   63.53982  -5.350336
21 + feature_25 -1    5.6777930        79   57.86203 -12.710882
22  + feature_2 -1    3.1203395        78   54.74169 -16.254462
23 + feature_31 -1    2.7627089        77   51.97898 -19.433077
24  + feature_1 -1    1.9879563        76   49.99102 -21.332672
25  + feature_4 -1    1.8963972        75   48.09463 -23.199972
26 + feature_57 -1    1.4942218        74   46.60040 -24.356095
27 + feature_12 -1    1.4234196        73   45.17699 -25.458240
28 + feature_94 -1    1.7120709        72   43.46491 -27.321614
29 + feature_68 -1    1.6782632        71   41.78665 -29.259324
30 + feature_10 -1    1.1838608        70   40.60279 -30.133339
31 + feature_74 -1    0.8808615        69   39.72193 -30.326678
32 + feature_95 -1    0.9565675        68   38.76536 -30.764308
33 + feature_51 -1    0.8287913        67   37.93657 -30.925462
34 + feature_79 -1    0.8231001        66   37.11347 -31.119020
35 + feature_82 -1    1.0088915        65   36.10458 -31.875049
~~~
{: .output}



~~~
plot(coef(forward), beta[names(coef(forward))])
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-5-1.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" width="612" style="display: block; margin: auto;" />


~~~
## note about backward/both, not a challenge
all <- lm(y ~ . + 0, data = xy)
backward <- step(
    all,
    scope = formula(all),
    direction = "backward",
    trace = 0
)
backward$anova
~~~
{: .language-r}



~~~
          Step Df     Deviance Resid. Df Resid. Dev       AIC
1              NA           NA         1  0.5634740 -319.8804
2 - feature_64  1 0.0000673451         2  0.5635414 -321.8685
3  - feature_9  1 0.0002502084         3  0.5637916 -323.8241
4 - feature_83  1 0.0016604913         4  0.5654521 -325.5300
~~~
{: .output}



~~~
plot(coef(backward), beta[names(coef(backward))])
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-6-1.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" width="612" style="display: block; margin: auto;" />


{% include links.md %}
