---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 02-high-dimensional-regression_b.md in _episodes_rmd/
title: "Stepwise feature selection for regression"
teaching: 0
exercises: 0
questions:
- "Why would we want to find a subset of features
  that are associated with an outcome?"
- "How can we iteratively find a good subset of our features
  variables to use for regression?"
- "What are some risks and downsides of iterative feature
  selection?"
objectives:
- "Understand multiple regression in a biomedical context."
- "Understand how to fit a stepwise regression model."
keypoints:
- "Sets of features can be more predictive and provide
  a better explanation than a single feature alone."
- "Stepwise regression allows us to find a set of features that
  are associated with an outcome (eg, age)."
- "Stepwise regression will tend to retain only one
  feature out of many that are correlated."
- "Stepwise regression is not very efficient."
math: yes
---





In the previous 

Another way of modelling these data is to model age as 

$$
    y_j = \beta_0 + \beta_1 X_1 + \dots \beta_p X_p + \epsilon_j
$$



~~~
suppressPackageStartupMessages({
    library("glmnet")
    library("limma")
    library("minfi")
    library("here")
    library("broom")
})

if (!file.exists(here("data/methylation.rds"))) {
    source(here("data/methylation.R"))
}
norm <- readRDS(here("data/methylation.rds"))

lim <- norm
y <- lim$Age
X <- getM(lim)
~~~
{: .language-r}

However when the number of predictors is greater than the number of samples
(basically always true in genetics) it isn't possible to include everything!

There are some techniques that you can use to find a set of predictors!

- screening (correlation etc): bad, don't do
- screening (variance): not necessarily bad if the screening variable is sensible
- forward/reverse/best subset selection


~~~
if (!file.exists(here("data/synthetic.rds"))) {
    source(here("data/synthetic.R"))
}
synthetic <- readRDS(here("data/synthetic.rds"))
~~~
{: .language-r}





~~~
X <- assay(synthetic)
y <- synthetic$age
beta <- rowData(synthetic)$true_beta
names(beta) <- rownames(synthetic)
## challenge 3: fit y on x univariate
## compare with true betas
cc <- sapply(seq_len(nrow(X)), function(i) {
    coef(lm(y ~ X[i, ]))[[2]]
})
plot(cc, beta, pch = 19, cex = 0.5)
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-4-1.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" width="612" style="display: block; margin: auto;" />




> ## Exercise
> Perform forward subset selection on the methylation data.
> 
> 
> > ## Solution
> > 
> > 
> {: .solution}
{: .challenge}




~~~
## challenge 4: forward selection
## compare with true betas
xy <- as.data.frame(cbind(t(X), y = y))
int <- lm(y ~ 1, data = xy)
all <- lm(y ~ . + 0, data = xy)
forward <- step(
    int,
    scope = list(upper = formula(all), lower = formula(int)),
    direction = "forward",
    trace = 0
)
forward$anova
~~~
{: .language-r}



~~~
           Step Df    Deviance Resid. Df Resid. Dev        AIC
1               NA          NA        99 2284.96000 314.893361
2  + feature_94 -1 823.4011612        98 1461.55884 272.208866
3  + feature_18 -1 472.6484771        97  988.91036 235.143351
4  + feature_43 -1 355.1210145        96  633.78935 192.654645
5  + feature_54 -1 106.3331634        95  527.45618 176.289561
6  + feature_37 -1  78.9389719        94  448.51721 162.077687
7  + feature_19 -1  70.6265938        93  377.89062 146.943460
8  + feature_56 -1  65.2411622        92  312.64946 129.991243
9  + feature_28 -1  64.8622144        91  247.78724 108.740029
10  + feature_1 -1  57.5328595        90  190.25438  84.319184
11 + feature_20 -1  47.5095628        89  142.74482  57.588837
12 + feature_96 -1  17.7985971        88  124.94622  46.271323
13 + feature_46 -1  13.5200307        87  111.42619  36.819222
14 + feature_98 -1  13.3282674        86   98.09792  26.079602
15 + feature_79 -1   7.0989864        85   90.99894  20.567764
16 + feature_67 -1   8.5414160        84   82.45752  12.711308
17 + feature_69 -1   5.0092170        83   77.44830   8.444049
18 + feature_59 -1   5.3798436        82   72.06846   3.244633
19 + feature_74 -1   4.5994378        81   67.46902  -1.350161
20 + feature_83 -1   4.2038033        80   63.26522  -5.783446
21 + feature_95 -1   3.1415051        79   60.12371  -8.876583
22  + feature_8 -1   3.3023979        78   56.82132 -12.525863
23 + feature_89 -1   3.0940905        77   53.72723 -16.125030
24 + feature_92 -1   2.0352647        76   51.69196 -17.986790
25 + feature_78 -1   1.9666019        75   49.72536 -19.865512
26 + feature_15 -1   1.7244808        74   48.00088 -21.395086
27 + feature_84 -1   1.6184393        73   46.38244 -22.824925
28 + feature_57 -1   1.4722741        72   44.91017 -24.050601
29 + feature_53 -1   1.3124508        71   43.59771 -25.016545
30 + feature_60 -1   1.0427141        70   42.55500 -25.437281
31 + feature_26 -1   0.9650231        69   41.58998 -25.731097
32 + feature_82 -1   1.2323761        68   40.35760 -26.739042
33 + feature_75 -1   1.3713170        67   38.98628 -28.196028
34 + feature_35 -1   0.9742339        66   38.01205 -28.726696
35 + feature_34 -1   0.9150206        65   37.09703 -29.163327
36  + feature_5 -1   0.8673792        64   36.22965 -29.529232
37 + feature_31 -1   1.0701369        63   35.15951 -30.527494
38 + feature_52 -1   1.0819509        62   34.07756 -31.653100
39  + feature_7 -1   1.1174750        61   32.96009 -32.987282
~~~
{: .output}



~~~
plot(coef(forward), beta[names(coef(forward))])
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-5-1.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" width="612" style="display: block; margin: auto;" />


~~~
## note about backward/both, not a challenge
all <- lm(y ~ . + 0, data = xy)
backward <- step(
    all,
    scope = formula(all),
    direction = "backward",
    trace = 0
)
backward$anova
~~~
{: .language-r}



~~~
          Step Df  Deviance Resid. Df Resid. Dev       AIC
1              NA        NA         1   2.525174 -169.8860
2 - feature_58  1 0.0078791         2   2.533053 -171.5745
3  - feature_6  1 0.0364433         3   2.569497 -172.1460
~~~
{: .output}



~~~
plot(coef(backward), beta[names(coef(backward))])
abline(0, 1)
abline(v = 0, lty = "dashed", col = "firebrick")
abline(h = 0, lty = "dashed", col = "firebrick")
~~~
{: .language-r}

<img src="../fig/rmd-02b-unnamed-chunk-6-1.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" width="612" style="display: block; margin: auto;" />


{% include links.md %}
