---
# Please do not edit this file directly; it is auto generated.
# Instead, please edit 02-high-dimensional-regression.md in _episodes_rmd/
title: "High dimensional regression"
teaching: 0
exercises: 0
questions:
- "How can we apply regression methods in a high-dimensional setting?"
- "How can we control for the fact that we do many tests?"
- "How can we benefit from the fact that we have many variables?"
- "How can we find a good subset of variables to use for regression?"
objectives:
- "Perform and critically analyse high dimensional regression."
- "Perform multiple testing adjustment."
- "Perform and critically analyse penalised regression."
keypoints:
- "Multiple testing correction can enable us to account for many null hypothesis
    significance tests while retaining power."
- "Sharing information between features can increase power and reduce false 
    positives."
- "Modelling features together can help to identify a subset of features
    that contribute to the outcome."
math: yes
---




R code in RMarkdown (with output):


~~~
rnorm(5)
~~~
{: .language-r}



~~~
[1]  0.6447702  0.8196423 -0.6492470 -0.1720951 -0.5576518
~~~
{: .output}

$\LaTeX$ inline, and in blocks:


$$
    \exp(i\pi) = -1
$$



~~~
suppressPackageStartupMessages({
    library("glmnet")
    library("limma")
    library("qvalue")
    library("minfi")
    library("here")
    library("FlowSorted.Blood.EPIC")
    library("IlluminaHumanMethylationEPICmanifest")
    library("IlluminaHumanMethylationEPICanno.ilm10b4.hg19")
    library("ExperimentHub")
    library("here")
})

if (!file.exists(here("data/FlowSorted_Blood_EPIC.rds"))) {
    source(here("data/methylation.R"))
}
~~~
{: .language-r}



~~~
using temporary cache /tmp/RtmptAAIzo/BiocFileCache
~~~
{: .output}



~~~
snapshotDate(): 2020-10-27
~~~
{: .output}



~~~
see ?FlowSorted.Blood.EPIC and browseVignettes('FlowSorted.Blood.EPIC') for documentation
~~~
{: .output}



~~~
downloading 1 resources
~~~
{: .output}



~~~
retrieving 1 resource
~~~
{: .output}



~~~
Warning: download failed
  web resource path: 'https://experimenthub.bioconductor.org/fetch/1136'
  local file path: '/tmp/RtmptAAIzo/BiocFileCache/305038c19c45_1136'
  reason: Internal Server Error (HTTP 500).
~~~
{: .warning}



~~~
Warning: bfcadd() failed; resource removed
  rid: BFC3
  fpath: 'https://experimenthub.bioconductor.org/fetch/1136'
  reason: download failed
~~~
{: .warning}



~~~
Warning: download failed
  hub path: 'https://experimenthub.bioconductor.org/fetch/1136'
  cache resource: 'EH1136 : 1136'
  reason: bfcadd() failed; see warnings()
~~~
{: .warning}



~~~
Error: failed to load resource
  name: EH1136
  title: FlowSorted.Blood.EPIC: Illumina Human Methylation data from EPIC on immunomagnetic sorted adult blood cell populations
  reason: 1 resources failed to download
~~~
{: .error}



~~~
norm <- readRDS(here("data/FlowSorted_Blood_EPIC.rds"))
~~~
{: .language-r}



~~~
Warning in gzfile(file, "rb"): cannot open compressed file '/home/
runner/work/high-dimensional-stats-r/high-dimensional-stats-r/data/
FlowSorted_Blood_EPIC.rds', probable reason 'No such file or directory'
~~~
{: .warning}



~~~
Error in gzfile(file, "rb"): cannot open the connection
~~~
{: .error}



~~~
lim <- norm
# lim <- lim[sample(nrow(lim), nrow(norm) / 10), ]


y <- lim$Age
~~~
{: .language-r}



~~~
Error in lim$Age: object of type 'closure' is not subsettable
~~~
{: .error}



~~~
# dfs <- mclapply(1:10000,
#     function(i) {
#         cat(i, "/", ncol(x), "\n")
#         df <- tidy(lm(x[, i] ~ y))[2, ]
#         df$term <- colnames(x)[[i]]
#         df
#     }, mc.cores = 8
# )
# df_all <- do.call(rbind, dfs)


## age - strong comparison
design <- model.matrix(~lim$Age)
~~~
{: .language-r}



~~~
Error in lim$Age: object of type 'closure' is not subsettable
~~~
{: .error}



~~~
colnames(design) <- c("intercept", "age")
~~~
{: .language-r}



~~~
Error in `colnames<-`(`*tmp*`, value = c("intercept", "age")): attempt to set 'colnames' on an object with less than two dimensions
~~~
{: .error}



~~~
fit <- lmFit(getM(lim)[1:10000, ], design = design)
~~~
{: .language-r}



~~~
Error in (function (classes, fdef, mtable) : unable to find an inherited method for function 'getM' for signature '"standardGeneric"'
~~~
{: .error}



~~~
fit <- eBayes(fit)
~~~
{: .language-r}



~~~
Error in .ebayes(fit = fit, proportion = proportion, stdev.coef.lim = stdev.coef.lim, : object 'fit' not found
~~~
{: .error}



~~~
tt1 <- topTable(fit, coef = 2, number = nrow(fit))
~~~
{: .language-r}



~~~
Error in is(fit, "MArrayLM"): object 'fit' not found
~~~
{: .error}



~~~
plot(tt1$logFC, -log10(tt1$P.Value))
~~~
{: .language-r}



~~~
Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'tt1' not found
~~~
{: .error}



~~~
q <- qvalue(tt1$P.Value)
~~~
{: .language-r}



~~~
Error in qvalue(tt1$P.Value): object 'tt1' not found
~~~
{: .error}



~~~
hist(q)
~~~
{: .language-r}



~~~
Error in hist.default(q): 'x' must be numeric
~~~
{: .error}



~~~
# plot(df_all$p.value, tt1[df_all$term, "P.Value"], log = "xy")
# plot(df_all$estimate, tt1[df_all$term, "logFC"])





design <- model.matrix(~0 + lim$bmi_clas)
~~~
{: .language-r}



~~~
Error in lim$bmi_clas: object of type 'closure' is not subsettable
~~~
{: .error}



~~~
colnames(design) <- gsub("lim$bmi_clas", "", colnames(design), fixed=TRUE)
~~~
{: .language-r}



~~~
Error in `colnames<-`(`*tmp*`, value = character(0)): attempt to set 'colnames' on an object with less than two dimensions
~~~
{: .error}



~~~
fit <- lmFit(getM(lim), design = design)
~~~
{: .language-r}



~~~
Error in (function (classes, fdef, mtable) : unable to find an inherited method for function 'getM' for signature '"standardGeneric"'
~~~
{: .error}



~~~
contrasts <- makeContrasts(
    Overweight - Normal,
    Obese - Normal,
    levels = design
)
~~~
{: .language-r}



~~~
Error in if (levels[1] == "(Intercept)") {: argument is of length zero
~~~
{: .error}



~~~
fit <- contrasts.fit(fit, contrasts)
~~~
{: .language-r}



~~~
Error in contrasts.fit(fit, contrasts): object 'fit' not found
~~~
{: .error}



~~~
fit <- eBayes(fit)
~~~
{: .language-r}



~~~
Error in .ebayes(fit = fit, proportion = proportion, stdev.coef.lim = stdev.coef.lim, : object 'fit' not found
~~~
{: .error}



~~~
tt1 <- topTable(fit, coef = 1, number = nrow(fit))
~~~
{: .language-r}



~~~
Error in is(fit, "MArrayLM"): object 'fit' not found
~~~
{: .error}



~~~
tt2 <- topTable(fit, coef = 2, number = nrow(fit))
~~~
{: .language-r}



~~~
Error in is(fit, "MArrayLM"): object 'fit' not found
~~~
{: .error}



~~~
q <- qvalue(tt2$P.Value)
~~~
{: .language-r}



~~~
Error in qvalue(tt2$P.Value): object 'tt2' not found
~~~
{: .error}



~~~
tt2$qvalue <- q$qvalue
~~~
{: .language-r}



~~~
Error in q$qvalue: object of type 'closure' is not subsettable
~~~
{: .error}



~~~
design <- model.matrix(~0 + lim$smoker)
~~~
{: .language-r}



~~~
Error in lim$smoker: object of type 'closure' is not subsettable
~~~
{: .error}



~~~
colnames(design) <- gsub("lim$smoker", "", colnames(design), fixed=TRUE)
~~~
{: .language-r}



~~~
Error in `colnames<-`(`*tmp*`, value = character(0)): attempt to set 'colnames' on an object with less than two dimensions
~~~
{: .error}



~~~
fit <- lmFit(getM(lim), design = design)
~~~
{: .language-r}



~~~
Error in (function (classes, fdef, mtable) : unable to find an inherited method for function 'getM' for signature '"standardGeneric"'
~~~
{: .error}



~~~
contrasts <- makeContrasts(
    Yes - No,
    levels = design
)
~~~
{: .language-r}



~~~
Error in if (levels[1] == "(Intercept)") {: argument is of length zero
~~~
{: .error}



~~~
fit <- contrasts.fit(fit, contrasts)
~~~
{: .language-r}



~~~
Error in contrasts.fit(fit, contrasts): object 'fit' not found
~~~
{: .error}



~~~
fit <- eBayes(fit)
~~~
{: .language-r}



~~~
Error in .ebayes(fit = fit, proportion = proportion, stdev.coef.lim = stdev.coef.lim, : object 'fit' not found
~~~
{: .error}



~~~
tt1 <- topTable(fit, coef = 1, number = nrow(fit))
~~~
{: .language-r}



~~~
Error in is(fit, "MArrayLM"): object 'fit' not found
~~~
{: .error}



~~~
q <- qvalue(tt1$P.Value)
~~~
{: .language-r}



~~~
Error in qvalue(tt1$P.Value): object 'tt1' not found
~~~
{: .error}



~~~
hist(q)
~~~
{: .language-r}



~~~
Error in hist.default(q): 'x' must be numeric
~~~
{: .error}



~~~
plot(tt1$logFC, -log10(tt1$P.Value))
~~~
{: .language-r}



~~~
Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'tt1' not found
~~~
{: .error}



~~~
x <- t(getM(norm))
~~~
{: .language-r}



~~~
Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 't': unable to find an inherited method for function 'getM' for signature '"standardGeneric"'
~~~
{: .error}



~~~
y <- as.numeric(factor(norm$smoker)) - 1
~~~
{: .language-r}



~~~
Error in norm$smoker: object of type 'closure' is not subsettable
~~~
{: .error}



~~~
fit <- cv.glmnet(x = x, y = y, family="binomial")
~~~
{: .language-r}



~~~
Error in nrow(x): object 'x' not found
~~~
{: .error}



~~~
c <- coef(fit, s = fit$lambda.1se)
~~~
{: .language-r}



~~~
Error in h(simpleError(msg, call)): error in evaluating the argument 'object' in selecting a method for function 'coef': object 'fit' not found
~~~
{: .error}



~~~
c[c[, 1] != 0, 1]
~~~
{: .language-r}



~~~
Error in c[, 1]: object of type 'builtin' is not subsettable
~~~
{: .error}



~~~
y <- norm$Age
~~~
{: .language-r}



~~~
Error in norm$Age: object of type 'closure' is not subsettable
~~~
{: .error}



~~~
fit <- cv.glmnet(x = x, y = y)
~~~
{: .language-r}



~~~
Error in nrow(x): object 'x' not found
~~~
{: .error}



~~~
c <- coef(fit, s = fit$lambda.1se)
~~~
{: .language-r}



~~~
Error in h(simpleError(msg, call)): error in evaluating the argument 'object' in selecting a method for function 'coef': object 'fit' not found
~~~
{: .error}



~~~
coef <- c[c[, 1] != 0, 1]
~~~
{: .language-r}



~~~
Error in c[, 1]: object of type 'builtin' is not subsettable
~~~
{: .error}



~~~
plot(y, x[, names(which.max(coef[-1]))])
~~~
{: .language-r}



~~~
Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'y' not found
~~~
{: .error}


{% include links.md %}

